{"ast":null,"code":"import _regeneratorRuntime from\"@babel/runtime/regenerator\";import _classCallCheck from\"@babel/runtime/helpers/classCallCheck\";import _createClass from\"@babel/runtime/helpers/createClass\";import _possibleConstructorReturn from\"@babel/runtime/helpers/possibleConstructorReturn\";import _getPrototypeOf from\"@babel/runtime/helpers/getPrototypeOf\";import _inherits from\"@babel/runtime/helpers/inherits\";import React from\"react\";import StyleSheet from\"react-native-web/dist/exports/StyleSheet\";import Text from\"react-native-web/dist/exports/Text\";import TouchableOpacity from\"react-native-web/dist/exports/TouchableOpacity\";import View from\"react-native-web/dist/exports/View\";import TextInput from\"react-native-web/dist/exports/TextInput\";import Alert from\"react-native-web/dist/exports/Alert\";import Image from\"react-native-web/dist/exports/Image\";import ScrollView from\"react-native-web/dist/exports/ScrollView\";import StatusBar from\"react-native-web/dist/exports/StatusBar\";import{KeyboardAwareScrollView}from\"react-native-keyboard-aware-scroll-view\";import axios from\"axios\";import{SettingApp}from\"../appConfig\";import AsyncStorage from\"react-native-web/dist/exports/AsyncStorage\";import moment from\"moment\";import\"moment/locale/th\";moment.locale(\"th\");var History=function(_React$Component){_inherits(History,_React$Component);function History(){var _getPrototypeOf2;var _this;_classCallCheck(this,History);for(var _len=arguments.length,args=new Array(_len),_key=0;_key<_len;_key++){args[_key]=arguments[_key];}_this=_possibleConstructorReturn(this,(_getPrototypeOf2=_getPrototypeOf(History)).call.apply(_getPrototypeOf2,[this].concat(args)));_this.state={historyData:[],User:''};_this.componentDidMount=function _callee(){var value;return _regeneratorRuntime.async(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.prev=0;_context.next=3;return _regeneratorRuntime.awrap(AsyncStorage.getItem(\"@User\"));case 3:value=_context.sent;if(!(value!==null)){_context.next=7;break;}_context.next=7;return _regeneratorRuntime.awrap(_this.setState({User:JSON.parse(value)}));case 7:_context.next=12;break;case 9:_context.prev=9;_context.t0=_context[\"catch\"](0);console.log(_context.t0);case 12:_this.fetchData();case 13:case\"end\":return _context.stop();}}},null,null,[[0,9]]);};_this.fetchData=function _callee2(){var User,response,historyData;return _regeneratorRuntime.async(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:User=_this.state.User;_context2.next=3;return _regeneratorRuntime.awrap(fetch(SettingApp+\"/WorkStatusHistory?user_id=\"+User.user_id));case 3:response=_context2.sent;_context2.next=6;return _regeneratorRuntime.awrap(response.json());case 6:historyData=_context2.sent;_this.setState({historyData:historyData});case 8:case\"end\":return _context2.stop();}}});};return _this;}_createClass(History,[{key:\"render\",value:function render(){var Month=[];return React.createElement(View,{style:styles.container},React.createElement(StatusBar,{barStyle:\"dark-content\"}),React.createElement(ScrollView,null,this.state.historyData.map(function(items,key){var dataDateTimeIn=items.Time_In.split(\" \");var dataDateTimeOut=items.Time_Out!=null?items.Time_Out.split(\" \"):\"ยังไม่ออกงาน\";var timeOut=dataDateTimeOut!=\"ยังไม่ออกงาน\"&&dataDateTimeOut[1];var textMonth=moment(dataDateTimeIn[0]).format(\"MMMM \")+\" \"+(parseInt(moment(dataDateTimeIn[0]).format(\"YYYY\"))+543);var findIfExist=Month.indexOf(textMonth);if(findIfExist==-1)Month.push(textMonth);return React.createElement(View,{key:key},findIfExist==-1&&React.createElement(Text,{style:styles.MonthTitle},textMonth),React.createElement(View,{style:styles.card,key:key},React.createElement(View,{style:{width:100,justifyContent:\"center\",alignItems:\"center\"}},items.Vehicle_Type==\"Bus\"&&React.createElement(Image,{style:styles.image,source:require(\"../assets/icon/icon_Bus.png\")}),items.Vehicle_Type==\"Boat\"&&React.createElement(Image,{style:styles.image,source:require(\"../assets/icon/icon_Boat.png\")}),items.Vehicle_Type==\"Van\"&&React.createElement(Image,{style:styles.image,source:require(\"../assets/icon/icon_Van.png\")}),items.Vehicle_Type==\"Truck\"&&React.createElement(Image,{style:styles.image,source:require(\"../assets/icon/icon_Truck.png\")})),React.createElement(View,null,React.createElement(Text,{style:styles.content},moment(dataDateTimeIn[0]).format(\"วันdddd D MMMM \"),parseInt(moment(dataDateTimeIn[0]).format(\"YYYY\"))+543),React.createElement(Text,{style:styles.content},\"\\u0E40\\u0E27\\u0E25\\u0E32\\u0E40\\u0E02\\u0E49\\u0E32\\u0E07\\u0E32\\u0E19 : \",dataDateTimeIn[1],\" \\u0E19.\"),React.createElement(Text,{style:styles.content},\"\\u0E40\\u0E27\\u0E25\\u0E32\\u0E2D\\u0E2D\\u0E01\\u0E07\\u0E32\\u0E19 : \",timeOut||\"ยังไม่ออกงาน\"),React.createElement(Text,{style:styles.content},\"\\u0E1E\\u0E32\\u0E2B\\u0E19\\u0E30\\u0E17\\u0E35\\u0E48\\u0E43\\u0E0A\\u0E49 : \",items.Vehicle_Name),React.createElement(Text,{style:styles.content},\"\\u0E40\\u0E27\\u0E25\\u0E32\\u0E17\\u0E33\\u0E07\\u0E32\\u0E19 : \",items.workTime,\" \\u0E0A\\u0E21.\"))));})));}}]);return History;}(React.Component);History.navigationOptions={title:\"ประวัติการทำงาน\",gesturesEnabled:false};export{History as default};var styles=StyleSheet.create({container:{backgroundColor:\"#F9F9F9\",flex:3,justifyContent:\"flex-start\",alignItems:\"center\",paddingTop:10},card:{flexDirection:\"row\",backgroundColor:\"#fff\",marginTop:10,marginBottom:10,paddingTop:10,paddingBottom:10,paddingStart:10,paddingEnd:10,borderRadius:10,width:350,shadowOffset:{width:5,height:5},shadowColor:\"rgba(222,222,222,1)\",shadowOpacity:0.5,shadowRadius:10},title:{fontSize:18,marginBottom:5,fontSize:14},MonthTitle:{fontSize:18,marginTop:15,fontWeight:\"bold\"},image:{width:60,height:60}});","map":{"version":3,"sources":["/Users/thanutpond/Desktop/whereApp/screens/History.js"],"names":["React","KeyboardAwareScrollView","axios","SettingApp","moment","locale","History","state","historyData","User","componentDidMount","AsyncStorage","getItem","value","setState","JSON","parse","console","log","fetchData","fetch","user_id","response","json","Month","styles","container","map","items","key","dataDateTimeIn","Time_In","split","dataDateTimeOut","Time_Out","timeOut","textMonth","format","parseInt","findIfExist","indexOf","push","MonthTitle","card","width","justifyContent","alignItems","Vehicle_Type","image","require","content","Vehicle_Name","workTime","Component","navigationOptions","title","gesturesEnabled","StyleSheet","create","backgroundColor","flex","paddingTop","flexDirection","marginTop","marginBottom","paddingBottom","paddingStart","paddingEnd","borderRadius","shadowOffset","height","shadowColor","shadowOpacity","shadowRadius","fontSize","fontWeight"],"mappings":"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","sourcesContent":["import React from \"react\";\nimport {\n  StyleSheet,\n  Text,\n  TouchableOpacity,\n  View,\n  TextInput,\n  Alert,\n  Image,\n  ScrollView,\n  StatusBar\n} from \"react-native\";\nimport { KeyboardAwareScrollView } from \"react-native-keyboard-aware-scroll-view\";\nimport axios from \"axios\";\nimport { SettingApp } from \"../appConfig\";\nimport { AsyncStorage } from \"react-native\";\nimport moment from \"moment\"; \nimport \"moment/locale/th\"; // without this line it didn't work\nmoment.locale(\"th\");\n\nexport default class History extends React.Component {\n\n  static navigationOptions = { \n    title: \"ประวัติการทำงาน\", //ชื่อด้านบนแอป\n    gesturesEnabled: false,  // ปิดการ Back\n  };\n\n  state = { \n    historyData: [], //สร้างตัวแปรเก็บค่าประวัติที่ดึงมาจาก Database\n    User : '' //เก็บค่า User จาก Localstorage\n  };\n\n  componentDidMount = async() => {\n    try { // ดึงค่าจาก Localstrage\n      const value = await AsyncStorage.getItem(\"@User\");\n      if (value !== null) {\n        await this.setState({ User: JSON.parse(value) });\n      }\n    } catch (error) {\n      console.log(error);\n    }\n\n    this.fetchData(); // เรียกฟังชั่น Fetchdata\n  };\n\n  fetchData = async () => {\n    let {User} = this.state \n    const response = await fetch( //สร้างตัวแปรสำหรับเรียกดูค่า History ใน Database โดยค้นหาจาก User_id\n      `${SettingApp}/WorkStatusHistory?user_id=${User.user_id}`\n    ); \n    const historyData = await response.json(); // แปลงค่าที่รับมาเป็น Json\n\n    this.setState({ historyData }); // เก็บค่าลงใน State\n  };\n\n  render() {\n    let Month = []; //สร้างตัวแปรสำหรับเก็บค่าเดือน\n\n    return (\n      <View style={styles.container}>\n        <StatusBar barStyle=\"dark-content\" /> \n        {/* เปลี่ยนสี status bar ให้เป็นสีดำ */}\n\n        {/* <Text style={styles.title}>ประวัติการทำงาน</Text> */}\n        <ScrollView>\n\n          {this.state.historyData.map((items, key) => { // นำค่าในที่ดึงมาจาก Database มาวนลูปเพื่อสร้าง Card\n            var dataDateTimeIn = items.Time_In.split(\" \"); // ใช้คำสั่ง split แยกระหว่างวันที่ กับเดือน\n            var dataDateTimeOut =\n              items.Time_Out != null //สร้างเงื่อนไขเช็คว่ามีเวลาออกหรือยัง\n                ? items.Time_Out.split(\" \") // ใช้คำสั่ง split แยกระหว่างวันที่ กับเดือน\n                : \"ยังไม่ออกงาน\";\n\n            // เช็คว่าถ้ายังไม่ออกจากงานให้แสดง \"ยังไม่ออกงาน\" แต่ถ้าออกแล้วให้ใส่ค่าเวลาที่ออก\n            let timeOut = dataDateTimeOut != \"ยังไม่ออกงาน\" && dataDateTimeOut[1];\n            let textMonth = `${moment(dataDateTimeIn[0]).format( // เปลี่ยน Format ให้เป็น 10 มกราคม 2563\n              \"MMMM \"\n            )} ${parseInt(moment(dataDateTimeIn[0]).format(\"YYYY\")) + 543}`;\n\n            var findIfExist = Month.indexOf(textMonth); //หาเดือนที่ซ้ำ\n            if (findIfExist == -1) Month.push(textMonth); // ถ้าไม่เจอเดือนทีี่ซ้ำให้เก็บค่าเดือนนั้นลงในตัวแปร\n            return (\n              <View key={key}>\n                {findIfExist == -1 && (\n                  <Text style={styles.MonthTitle}>{textMonth}</Text>\n                )}\n                <View style={styles.card} key={key}>\n                  <View\n                    style={{\n                      width: 100,\n                      justifyContent: \"center\",\n                      alignItems: \"center\"\n                    }}\n                  >\n                    {\n                    items.Vehicle_Type == \"Bus\" && (\n                      <Image\n                        style={styles.image}\n                        source={require(`../assets/icon/icon_Bus.png`)}\n                      />\n                    )}\n                    {items.Vehicle_Type == \"Boat\" && (\n                      <Image\n                        style={styles.image}\n                        source={require(`../assets/icon/icon_Boat.png`)}\n                      />\n                    )}\n                    {items.Vehicle_Type == \"Van\" && (\n                      <Image\n                        style={styles.image}\n                        source={require(`../assets/icon/icon_Van.png`)}\n                      />\n                    )}\n                    {items.Vehicle_Type == \"Truck\" && (\n                      <Image\n                        style={styles.image}\n                        source={require(`../assets/icon/icon_Truck.png`)}\n                      />\n                    )}\n                  </View>\n                  <View>\n                    <Text style={styles.content}>\n                      {moment(dataDateTimeIn[0]).format(\"วันdddd D MMMM \")}\n                      {parseInt(moment(dataDateTimeIn[0]).format(\"YYYY\")) + 543}\n                    </Text>\n                    <Text style={styles.content}>\n                      เวลาเข้างาน : {dataDateTimeIn[1]} น.\n                    </Text>\n                    <Text style={styles.content}>\n                      เวลาออกงาน : {timeOut || \"ยังไม่ออกงาน\"}\n                    </Text>\n                    <Text style={styles.content}>\n                      พาหนะที่ใช้ : {items.Vehicle_Name}\n                    </Text>\n                    <Text style={styles.content}>\n                      เวลาทำงาน : {items.workTime} ชม.\n                    </Text>\n                  </View>\n                </View>\n              </View>\n            );\n          })}\n        </ScrollView>\n      </View>\n    );\n  }\n}\nconst styles = StyleSheet.create({\n  container: {\n    backgroundColor: \"#F9F9F9\",\n    flex: 3,\n    justifyContent: \"flex-start\",\n    alignItems: \"center\",\n    paddingTop: 10\n  },\n  card: {\n    flexDirection: \"row\",\n    backgroundColor: \"#fff\",\n    marginTop: 10,\n    marginBottom: 10,\n    paddingTop: 10,\n    paddingBottom: 10,\n    paddingStart: 10,\n    paddingEnd: 10,\n    borderRadius: 10,\n    width: 350,\n    // boxShadow: 0px 4px 3px 0px rgba(222,222,222,1),\n    shadowOffset: { width: 5, height: 5 },\n    shadowColor: \"rgba(222,222,222,1)\",\n    shadowOpacity: 0.5,\n    shadowRadius: 10\n  },\n  title: {\n    fontSize: 18,\n    marginBottom: 5,\n    fontSize: 14\n  },\n  MonthTitle: {\n    fontSize: 18,\n    marginTop: 15,\n    fontWeight: \"bold\"\n  },\n  image: {\n    width: 60,\n    height: 60\n  }\n});\n"]},"metadata":{},"sourceType":"module"}