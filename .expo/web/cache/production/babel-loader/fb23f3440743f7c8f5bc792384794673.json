{"ast":null,"code":"import _taggedTemplateLiteralLoose from\"@babel/runtime/helpers/taggedTemplateLiteralLoose\";import _defineProperty from\"@babel/runtime/helpers/defineProperty\";import _regeneratorRuntime from\"@babel/runtime/regenerator\";import _classCallCheck from\"@babel/runtime/helpers/classCallCheck\";import _createClass from\"@babel/runtime/helpers/createClass\";import _possibleConstructorReturn from\"@babel/runtime/helpers/possibleConstructorReturn\";import _getPrototypeOf from\"@babel/runtime/helpers/getPrototypeOf\";import _inherits from\"@babel/runtime/helpers/inherits\";function _templateObject3(){var data=_taggedTemplateLiteralLoose([\"\\n  fontSize: 30;\\n  color: 'rgb(101,102,251)';\\n  textAlign: center;\\n  paddingLeft: 10;\\n  paddingRight: 10;\\n  marginTop: 10;\\n\"]);_templateObject3=function _templateObject3(){return data;};return data;}function _templateObject2(){var data=_taggedTemplateLiteralLoose([\"\\n  width: \",\";\\n  height: 90;\\n  backgroundColor: white;\\n  borderRadius: 60;\\n  borderBottomEndRadius :  0;\\n  borderBottomStartRadius :  0;\\n  borderWidth: 0;\\n  justifyContent: center;\\n  alignItems: center;\\n  marginTop : \",\";\\n  marginBottom : \",\"\\n  flexDirection: row;\\n\"]);_templateObject2=function _templateObject2(){return data;};return data;}function _templateObject(){var data=_taggedTemplateLiteralLoose([\"\\n  width: \",\";\\n  height: \",\";\\n  position:absolute;\\n  top:\",\";   \\n  backgroundColor: 'rgb(29,25,204)';\\n  borderRadius: 60;\\n  borderBottomEndRadius :  0;\\n  borderBottomStartRadius :  0;\\n  borderWidth: 0;\\n  justifyContent: flex-start;\\n  alignItems: center;\\n  paddingTop : 15;\\n  paddingBottom : 50;\\n\"]);_templateObject=function _templateObject(){return data;};return data;}function ownKeys(object,enumerableOnly){var keys=Object.keys(object);if(Object.getOwnPropertySymbols){var symbols=Object.getOwnPropertySymbols(object);if(enumerableOnly)symbols=symbols.filter(function(sym){return Object.getOwnPropertyDescriptor(object,sym).enumerable;});keys.push.apply(keys,symbols);}return keys;}function _objectSpread(target){for(var i=1;i<arguments.length;i++){var source=arguments[i]!=null?arguments[i]:{};if(i%2){ownKeys(source,true).forEach(function(key){_defineProperty(target,key,source[key]);});}else if(Object.getOwnPropertyDescriptors){Object.defineProperties(target,Object.getOwnPropertyDescriptors(source));}else{ownKeys(source).forEach(function(key){Object.defineProperty(target,key,Object.getOwnPropertyDescriptor(source,key));});}}return target;}import React from\"react\";Dimensions;import View from\"react-native-web/dist/exports/View\";import Text from\"react-native-web/dist/exports/Text\";import StyleSheet from\"react-native-web/dist/exports/StyleSheet\";import Image from\"react-native-web/dist/exports/Image\";import TouchableOpacity from\"react-native-web/dist/exports/TouchableOpacity\";import Dimensions from\"react-native-web/dist/exports/Dimensions\";import StatusBar from\"react-native-web/dist/exports/StatusBar\";import TextInput from\"react-native-web/dist/exports/TextInput\";import Keyboard from\"react-native-web/dist/exports/Keyboard\";import ScrollView from\"react-native-web/dist/exports/ScrollView\";import MapView,{PROVIDER_GOOGLE}from\"react-native-maps\";import{Marker}from\"react-native-maps\";import BusStopIcon from\"../components/BusStop\";import TruckActive from\"../components/TruckActive\";import BusStopDetail from\"../components/BusStopDetail\";import styled from\"styled-components\";import{SettingApp}from\"../appConfig\";import AsyncStorage from\"react-native-web/dist/exports/AsyncStorage\";import moment from\"moment\";import\"moment/locale/th\";moment.locale(\"th\");var App=function(_React$Component){_inherits(App,_React$Component);function App(){var _getPrototypeOf2;var _this;_classCallCheck(this,App);for(var _len=arguments.length,args=new Array(_len),_key=0;_key<_len;_key++){args[_key]=arguments[_key];}_this=_possibleConstructorReturn(this,(_getPrototypeOf2=_getPrototypeOf(App)).call.apply(_getPrototypeOf2,[this].concat(args)));_this.state={typing:false,searchTxt:\"\",openMenu:false,markers:[{title:\"Your Location\",description:\"คุณอยู่ที่นี่\"}],open:false,User:'',region:{latitude:0,longitude:0,latitudeDelta:0.015,longitudeDelta:0.0121},latlng:{latitude:0,longitude:0},busStop:[],busLine:[],BusActive:[]};_this.componentDidMount=function _callee(){var value;return _regeneratorRuntime.async(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.prev=0;_context.next=3;return _regeneratorRuntime.awrap(AsyncStorage.getItem(\"@User\"));case 3:value=_context.sent;if(!(value!==null)){_context.next=7;break;}_context.next=7;return _regeneratorRuntime.awrap(_this.setState({User:JSON.parse(value)}));case 7:_context.next=12;break;case 9:_context.prev=9;_context.t0=_context[\"catch\"](0);console.log(_context.t0);case 12:_context.next=14;return _regeneratorRuntime.awrap(_this.getLocation());case 14:_context.next=16;return _regeneratorRuntime.awrap(_this.fetchTruckActiveData());case 16:_this.intervalID=setInterval(function(){return _this.RefreshMaps();},5000);case 17:case\"end\":return _context.stop();}}},null,null,[[0,9]]);};_this.RefreshMaps=function _callee2(){var value;return _regeneratorRuntime.async(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:_context2.prev=0;_context2.next=3;return _regeneratorRuntime.awrap(AsyncStorage.getItem(\"@region\"));case 3:value=_context2.sent;if(!(value!==null)){_context2.next=7;break;}_context2.next=7;return _regeneratorRuntime.awrap(_this.setState({region:JSON.parse(value)}));case 7:_context2.next=12;break;case 9:_context2.prev=9;_context2.t0=_context2[\"catch\"](0);console.log(_context2.t0);case 12:_context2.next=14;return _regeneratorRuntime.awrap(_this.fetchTruckActiveData());case 14:console.log(\" time: \",moment().format(\"HH:mm:ss\"));case 15:case\"end\":return _context2.stop();}}},null,null,[[0,9]]);};_this.getLocation=function _callee3(){return _regeneratorRuntime.async(function _callee3$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:navigator.geolocation.getCurrentPosition(function(position){var latlng={latitude:parseFloat(JSON.stringify(position.coords.latitude)),longitude:parseFloat(JSON.stringify(position.coords.longitude))};var region={latitude:parseFloat(JSON.stringify(position.coords.latitude)),longitude:parseFloat(JSON.stringify(position.coords.longitude)),latitudeDelta:0.015,longitudeDelta:0.0121};_this.setState({latlng:latlng,region:region});},function(error){return alert(error.message);},{enableHighAccuracy:true,timeout:20000,maximumAge:1000});_context3.next=3;return _regeneratorRuntime.awrap(navigator.geolocation.watchPosition(function(position){var latlng={latitude:parseFloat(JSON.stringify(position.coords.latitude)),longitude:parseFloat(JSON.stringify(position.coords.longitude))};var region={latitude:parseFloat(JSON.stringify(position.coords.latitude)),longitude:parseFloat(JSON.stringify(position.coords.longitude)),latitudeDelta:0.015,longitudeDelta:0.0121};_this.setState({latlng:latlng,region:region});}));case 3:_this.watchID=_context3.sent;case 4:case\"end\":return _context3.stop();}}});};_this.fetchTruckActiveData=function _callee4(){var _this$state,searchTxt,busLine,lineQuery,response,BusActive,_response,_BusActive;return _regeneratorRuntime.async(function _callee4$(_context4){while(1){switch(_context4.prev=_context4.next){case 0:_this$state=_this.state,searchTxt=_this$state.searchTxt,busLine=_this$state.busLine;lineQuery=[];if(!(searchTxt==\"\")){_context4.next=13;break;}_context4.next=5;return _regeneratorRuntime.awrap(fetch(SettingApp+\"/getVehicleActive?Vehicle_Type='Truck'\"));case 5:response=_context4.sent;_context4.next=8;return _regeneratorRuntime.awrap(response.json());case 8:BusActive=_context4.sent;_context4.next=11;return _regeneratorRuntime.awrap(_this.setState({BusActive:BusActive}));case 11:_context4.next=22;break;case 13:busLine.map(function(item){lineQuery.push(item.data.busline_code);});_context4.next=16;return _regeneratorRuntime.awrap(fetch(SettingApp+\"/getVehicleActiveQuery?Vehicle_Type='Truck'&lineQuery=\"+lineQuery));case 16:_response=_context4.sent;_context4.next=19;return _regeneratorRuntime.awrap(_response.json());case 19:_BusActive=_context4.sent;_context4.next=22;return _regeneratorRuntime.awrap(_this.setState({BusActive:_BusActive}));case 22:case\"end\":return _context4.stop();}}});};_this.componentWillUnmount=function(){clearInterval(_this.intervalID);navigator.geolocation.clearWatch(_this.watchID);};_this.onOutFocus=function _callee5(){return _regeneratorRuntime.async(function _callee5$(_context5){while(1){switch(_context5.prev=_context5.next){case 0:Keyboard.dismiss();_context5.next=3;return _regeneratorRuntime.awrap(_this.setState({typing:false,searchTxt:''}));case 3:_context5.next=5;return _regeneratorRuntime.awrap(_this.fetchTruckActiveData());case 5:case\"end\":return _context5.stop();}}});};_this.onRegionChangeComplete=function _callee6(region){return _regeneratorRuntime.async(function _callee6$(_context6){while(1){switch(_context6.prev=_context6.next){case 0:console.log('onRegionChangeComplete ::: ',region);_context6.prev=1;_context6.next=4;return _regeneratorRuntime.awrap(AsyncStorage.setItem('@region',JSON.stringify(region)));case 4:_context6.next=9;break;case 6:_context6.prev=6;_context6.t0=_context6[\"catch\"](1);console.log(_context6.t0);case 9:case\"end\":return _context6.stop();}}},null,null,[[1,6]]);};return _this;}_createClass(App,[{key:\"render\",value:function render(){var _this$state2=this.state,region=_this$state2.region,latlng=_this$state2.latlng;return React.createElement(View,{style:styles.container},React.createElement(StatusBar,{barStyle:\"dark-content\"}),React.createElement(MapView,{provider:PROVIDER_GOOGLE,style:styles.map,onRegionChange:this.onRegionChangeComplete,region:this.state.region},this.state.busStop.map(function(marker,key){var LatLng={latitude:parseFloat(marker.latitude),longitude:parseFloat(marker.longitude)};return React.createElement(Marker,{key:key,coordinate:LatLng,title:marker.busstop_name,description:marker.description},React.createElement(BusStopIcon,{textLine:marker.busline_name}));}),this.state.BusActive.map(function(marker,key){var LatLng={latitude:parseFloat(marker.lat)||10000,longitude:parseFloat(marker.lon)||10000};return React.createElement(Marker,{key:key,coordinate:LatLng,title:marker.busstop_name,description:marker.Vehicle_Name},React.createElement(TruckActive,{textLine:marker.busline_code}));}),React.createElement(Marker,{coordinate:this.state.latlng,title:this.state.markers.title,description:this.state.markers.description},React.createElement(View,null,React.createElement(Image,{source:require(\"../assets/icon/self-map-marker.png\"),style:{width:70,height:70,zIndex:100}})))));}}]);return App;}(React.Component);App.navigationOptions={title:\"Truck\",gesturesEnabled:false};export{App as default};var width=Dimensions.get(\"window\").width;var height=Dimensions.get(\"window\").height;var styles=StyleSheet.create({container:{flex:3,justifyContent:\"flex-end\",alignItems:\"center\"},map:_objectSpread({},StyleSheet.absoluteFillObject),Line:{width:90,height:6,backgroundColor:\"rgb(71, 69, 245)\",top:0,position:\"absolute\",borderRadius:50,marginTop:10},ViewFlex:{width:width-70,flexDirection:\"row\",paddingTop:20,paddingBottom:20,marginStart:30,marginEnd:30,justifyContent:\"flex-start\",alignItems:\"center\",borderBottomWidth:1,borderBottomColor:'rgba(255,255,255,0.5)'},LineFlex:{marginTop:20,width:300,height:0.5,backgroundColor:\"rgba(255,255,255,0.5)\",borderRadius:50},InputStyle:{marginTop:20,paddingBottom:20,fontSize:30,width:250,textAlign:\"center\",color:\"rgb(29, 25, 204)\"}});var MenuSlide=styled(View)(_templateObject(),width,function(props){return props.openMenu?500:150;},function(props){return props.openMenu?250:height-250;});var SearchTab=styled(View)(_templateObject2(),width,height-180,function(props){return props.typing?300:0;});var TextMenuSlide=styled(Text)(_templateObject3());","map":{"version":3,"sources":["/Users/thanutpond/Desktop/whereApp/screens/ShowMapTruck.js"],"names":["React","Dimensions","MapView","PROVIDER_GOOGLE","Marker","BusStopIcon","TruckActive","BusStopDetail","styled","SettingApp","moment","locale","App","state","typing","searchTxt","openMenu","markers","title","description","open","User","region","latitude","longitude","latitudeDelta","longitudeDelta","latlng","busStop","busLine","BusActive","componentDidMount","AsyncStorage","getItem","value","setState","JSON","parse","console","log","getLocation","fetchTruckActiveData","intervalID","setInterval","RefreshMaps","format","navigator","geolocation","getCurrentPosition","position","parseFloat","stringify","coords","error","alert","message","enableHighAccuracy","timeout","maximumAge","watchPosition","watchID","lineQuery","fetch","response","json","map","item","push","data","busline_code","componentWillUnmount","clearInterval","clearWatch","onOutFocus","Keyboard","dismiss","onRegionChangeComplete","setItem","styles","container","marker","key","LatLng","busstop_name","busline_name","lat","lon","Vehicle_Name","require","width","height","zIndex","Component","navigationOptions","gesturesEnabled","get","StyleSheet","create","flex","justifyContent","alignItems","absoluteFillObject","Line","backgroundColor","top","borderRadius","marginTop","ViewFlex","flexDirection","paddingTop","paddingBottom","marginStart","marginEnd","borderBottomWidth","borderBottomColor","LineFlex","InputStyle","fontSize","textAlign","color","MenuSlide","View","props","SearchTab","TextMenuSlide","Text"],"mappings":"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","sourcesContent":["import React from \"react\"\nDimensions\nimport {\n  View,\n  Text,\n  StyleSheet,\n  Image,\n  TouchableOpacity,\n  Dimensions,\n  StatusBar,\n  TextInput,\n  Keyboard,\n  ScrollView\n} from \"react-native\"\nimport MapView, { PROVIDER_GOOGLE } from \"react-native-maps\" // remove PROVIDER_GOOGLE import if not using Google Maps\nimport { Marker } from \"react-native-maps\"\nimport BusStopIcon from \"../components/BusStop\"\nimport TruckActive from \"../components/TruckActive\"\nimport BusStopDetail from \"../components/BusStopDetail\"\nimport styled from \"styled-components\"\nimport {SettingApp} from '../appConfig';\nimport { AsyncStorage } from \"react-native\";\nimport moment from \"moment\";\nimport \"moment/locale/th\"; // without this line it didn't work\nmoment.locale(\"th\");\n\nexport default class App extends React.Component {\n  static navigationOptions = {\n    title: \"Truck\",\n    gesturesEnabled: false,\n  }\n\n  state = {\n    typing: false,\n    searchTxt: \"\",\n    openMenu: false,\n    markers: [\n      {\n        title: \"Your Location\",\n        description: \"คุณอยู่ที่นี่\"\n      }\n    ],\n    open : false,\n    User : '',\n    region : {\n      latitude: 0,\n      longitude: 0,\n      latitudeDelta: 0.015,\n      longitudeDelta: 0.0121\n    },\n    latlng: {\n      latitude: 0,////////// UpdateState Every 5 Sec\n      longitude: 0\n    },\n    busStop: [],\n    busLine: [],\n    BusActive : [],\n  }\n\n  componentDidMount = async () => {\n    try {\n      const value = await AsyncStorage.getItem(\"@User\");\n      if (value !== null) {\n        await this.setState({ User: JSON.parse(value) });\n      }\n    } catch (error) {\n      console.log(error);\n    }\n    await this.getLocation()\n    await this.fetchTruckActiveData()\n    this.intervalID = setInterval(() => this.RefreshMaps(), 5000);\n    \n  }\n\n  RefreshMaps = async () => {\n    try {\n      const value = await AsyncStorage.getItem(\"@region\");\n      if (value !== null) {\n        await this.setState({ region: JSON.parse(value) });\n      }\n    } catch (error) {\n      console.log(error);\n    }\n\n    await this.fetchTruckActiveData()\n     console.log(\" time: \",moment().format(\"HH:mm:ss\"))\n  };\n\n  getLocation = async () => {\n    navigator.geolocation.getCurrentPosition(\n      position => {\n        let latlng = {\n          latitude: parseFloat(JSON.stringify(position.coords.latitude)),\n          longitude: parseFloat(JSON.stringify(position.coords.longitude))\n        }\n        let region ={\n          latitude: parseFloat(JSON.stringify(position.coords.latitude)),\n          longitude: parseFloat(JSON.stringify(position.coords.longitude)),\n          latitudeDelta: 0.015,\n          longitudeDelta: 0.0121\n        }\n        this.setState({ latlng , region  })\n        // console.log(\"re :::: \",this.state.region)\n      },\n      error => alert(error.message),\n      { enableHighAccuracy: true, timeout: 20000, maximumAge: 1000 }\n    )\n    this.watchID = await navigator.geolocation.watchPosition(position => {\n      let latlng = {\n        latitude: parseFloat(JSON.stringify(position.coords.latitude)),\n        longitude: parseFloat(JSON.stringify(position.coords.longitude))\n      }\n      let region ={\n        latitude: parseFloat(JSON.stringify(position.coords.latitude)),\n        longitude: parseFloat(JSON.stringify(position.coords.longitude)),\n        latitudeDelta: 0.015,\n        longitudeDelta: 0.0121\n      }\n      this.setState({ latlng , region })\n      // console.log(\"re :::: \",this.state.region)\n    })\n  }\n\n  fetchTruckActiveData = async () => {\n    let {searchTxt, busLine} = this.state\n    let lineQuery = []\n    if(searchTxt == \"\"){ \n    const response = await fetch(`${SettingApp}/getVehicleActive?Vehicle_Type='Truck'`)\n    const BusActive = await response.json()\n    // console.log(\"BusActive :::: \", BusActive)\n    await this.setState({ BusActive})\n    }else { \n      busLine.map(item => {\n        lineQuery.push(item.data.busline_code)\n      })\n      const response = await fetch(`${SettingApp}/getVehicleActiveQuery?Vehicle_Type='Truck'&lineQuery=${lineQuery}`)\n      const BusActive = await response.json()\n      await this.setState({ BusActive})\n    }\n  }\n\n  componentWillUnmount = () => {\n    clearInterval(this.intervalID);\n    navigator.geolocation.clearWatch(this.watchID)\n  }\n\n  onOutFocus = async () => {\n    Keyboard.dismiss()\n    await this.setState({ typing: false, searchTxt : '' })\n    await this.fetchTruckActiveData()\n\n  }\n\n  onRegionChangeComplete = async(region) => {\n    console.log('onRegionChangeComplete ::: ', region);\n    try {\n      await AsyncStorage.setItem('@region', JSON.stringify(region));\n    } catch (error) {\n      console.log(error)\n    }\n  };\n\n  render() {\n    let {region, latlng} = this.state\n    return (\n      <View style={styles.container}>\n        <StatusBar barStyle=\"dark-content\" />\n        <MapView\n          provider={PROVIDER_GOOGLE} // remove if not using Google Maps\n          style={styles.map}\n          onRegionChange={this.onRegionChangeComplete}\n          region={this.state.region}\n        >\n         \n          {this.state.busStop.map((marker, key) => {\n            let LatLng = {\n              latitude: parseFloat(marker.latitude),\n              longitude: parseFloat(marker.longitude)\n            }\n            return (\n              <Marker\n                key={key}\n                coordinate={LatLng}\n                title={marker.busstop_name}\n                description={marker.description}\n              >\n                <BusStopIcon textLine={marker.busline_name} />\n              </Marker>\n            )\n          })}\n          {this.state.BusActive.map((marker, key) => {\n            let LatLng = {\n              latitude: parseFloat(marker.lat) || 10000,\n              longitude: parseFloat(marker.lon) || 10000\n            }\n            return (\n              <Marker\n                key={key}\n                coordinate={LatLng}\n                title={marker.busstop_name}\n                description={marker.Vehicle_Name}\n              >\n                <TruckActive textLine={marker.busline_code}  />\n              </Marker>\n            )\n          })}\n           <Marker\n            coordinate={this.state.latlng}\n            title={this.state.markers.title}\n            description={this.state.markers.description}\n          >\n            <View>\n              <Image\n                source={require(\"../assets/icon/self-map-marker.png\")}\n                style={{ width: 70, height: 70, zIndex : 100 }}\n              />\n              {/* <Text>คุณอยู่ที่นี่</Text> */}\n            </View>\n          </Marker>\n        </MapView>\n\n        {/* ///////////////////////////////////////////////////// */}\n      </View>\n    )\n  }\n}\n\nlet width = Dimensions.get(\"window\").width\nlet height = Dimensions.get(\"window\").height\n\nconst styles = StyleSheet.create({\n  container: {\n    flex: 3,\n    justifyContent: \"flex-end\",\n    alignItems: \"center\"\n  },\n  map: {\n    ...StyleSheet.absoluteFillObject\n  },\n  Line: {\n    width: 90,\n    height: 6,\n    backgroundColor: \"rgb(71, 69, 245)\",\n    top: 0,\n    position: \"absolute\",\n    borderRadius: 50,\n    marginTop: 10\n  },\n  ViewFlex: {\n    width : width-70,\n    flexDirection: \"row\",\n    paddingTop : 20,\n    paddingBottom : 20,\n    marginStart :30,\n    marginEnd : 30,\n    justifyContent: \"flex-start\",\n    alignItems: \"center\",\n    borderBottomWidth : 1,\n    borderBottomColor : 'rgba(255,255,255,0.5)',\n  },\n  LineFlex: {\n   marginTop : 20,\n    width: 300,\n    height: 0.5,\n    backgroundColor: \"rgba(255,255,255,0.5)\",\n    borderRadius: 50,\n  },\n  InputStyle: {\n    marginTop: 20,\n    paddingBottom: 20,\n    fontSize: 30,\n    width: 250,\n    textAlign: \"center\",\n    color: \"rgb(29, 25, 204)\"\n  }\n})\n\nconst MenuSlide = styled(View)`\n  width: ${width};\n  height: ${props => props.openMenu ? 500 : 150};\n  position:absolute;\n  top:${props => props.openMenu ? 250 : height-250};   \n  backgroundColor: 'rgb(29,25,204)';\n  borderRadius: 60;\n  borderBottomEndRadius :  0;\n  borderBottomStartRadius :  0;\n  borderWidth: 0;\n  justifyContent: flex-start;\n  alignItems: center;\n  paddingTop : 15;\n  paddingBottom : 50;\n`;\n\nconst SearchTab = styled(View)`\n  width: ${width};\n  height: 90;\n  backgroundColor: white;\n  borderRadius: 60;\n  borderBottomEndRadius :  0;\n  borderBottomStartRadius :  0;\n  borderWidth: 0;\n  justifyContent: center;\n  alignItems: center;\n  marginTop : ${height-180};\n  marginBottom : ${props => props.typing ? 300 : 0}\n  flexDirection: row;\n`;\n\nconst TextMenuSlide = styled(Text)`\n  fontSize: 30;\n  color: 'rgb(101,102,251)';\n  textAlign: center;\n  paddingLeft: 10;\n  paddingRight: 10;\n  marginTop: 10;\n`"]},"metadata":{},"sourceType":"module"}